{"version":3,"file":"index.js","sources":["src/index.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\n\ninterface PopoverProps {\n  content: React.ReactNode | JSX.Element;\n}\nconst Popover: React.FC<PopoverProps> = ({ children, content }) => {\n  const elementRef = useRef<HTMLDivElement>(null);\n  const popoverRef = useRef<HTMLDivElement>(null);\n  const arrowRef = useRef<HTMLDivElement>(null);\n  const [popoverPosition, setPopoverPosition] = useState({\n    left: 0,\n    top: 0,\n    right: \"auto\",\n    bottom: \"auto\",\n    width: 200,\n    show: false,\n  });\n\n  const [arrowPosition, setArrowPosition] = useState({\n    left: 0,\n    right: \"auto\",\n    top: 0,\n    bottom: \"auto\",\n    clipPath: \"polygon(50% 0%, 0% 100%, 100% 100%)\",\n  });\n\n  const alignFromRight = () => {\n    const popoverBounding = popoverRef.current?.getBoundingClientRect();\n    console.log(popoverBounding, window.scrollY, window.innerHeight, document.body.scrollHeight);\n    const offsetTopNeed =\n      popoverBounding?.y || 0 + (!!popoverBounding?.height ? popoverBounding?.height : 0) - window.innerHeight;\n    const offsetLeftNeed =\n      (!!popoverBounding?.x ? popoverBounding?.x : 0) +\n      popoverPosition.width / 2 -\n      document.body.getBoundingClientRect().width +\n      (!!elementRef.current?.clientWidth ? elementRef.current?.clientWidth : 0);\n\n    if (offsetTopNeed > 0) {\n      setPopoverPosition({\n        ...popoverPosition,\n        show: true,\n        left:\n          -(popoverBounding?.width || 0 / 2 - (elementRef.current?.clientWidth || 0) / 2) -\n          (offsetLeftNeed > 0 ? offsetLeftNeed - (elementRef.current?.clientWidth || 0) / 2 : 0),\n        top: -((popoverBounding?.height || 0) + 5),\n      });\n\n      setArrowPosition((pre) => ({\n        ...pre,\n        top: -(elementRef.current?.clientHeight || 0) / 2,\n        clipPath: \"polygon(100% 0, 0 0, 50% 100%)\",\n      }));\n    } else {\n      setPopoverPosition({\n        ...popoverPosition,\n        show: true,\n        left:\n          -((popoverBounding?.width || 0) / 2 - (elementRef.current?.clientWidth || 0) / 2) -\n          (offsetLeftNeed > 0 ? offsetLeftNeed - (elementRef.current?.clientWidth || 1) / 2 : 0),\n        top: elementRef.current?.clientHeight || 0,\n      });\n\n      setArrowPosition((pre) => ({\n        ...pre,\n        top: elementRef.current?.clientHeight || 0,\n        clipPath: \"polygon(50% 0%, 0% 100%, 100% 100%)\",\n      }));\n    }\n  };\n\n  // useEffect\n  useEffect(() => {\n    const elementClickEvent = (e: MouseEvent) => {\n      if (!popoverRef.current?.contains(e.target as Node)) {\n        if (popoverPosition.show) {\n          setPopoverPosition((pre) => ({\n            ...pre,\n            show: false,\n            left: 0,\n            top: 0,\n          }));\n        } else {\n          alignFromRight();\n        }\n      }\n    };\n\n    if (!!elementRef.current && !!popoverRef.current && !!arrowRef.current) {\n      elementRef.current.addEventListener(\"click\", elementClickEvent);\n    }\n\n    return () => {\n      if (!!elementRef.current && !!popoverRef.current && !!arrowRef.current) {\n        elementRef.current.removeEventListener(\"click\", elementClickEvent);\n      }\n    };\n  }, [elementRef.current, popoverRef.current, popoverPosition, arrowRef.current]);\n\n  useEffect(() => {\n    const windowsClickEvent = (e: MouseEvent) => {\n      if (!elementRef.current?.contains(e.target as Node) && !popoverRef.current?.contains(e.target as Node)) {\n        setPopoverPosition((pre) => ({\n          ...pre,\n          show: false,\n          left: 0,\n          top: 0,\n        }));\n      }\n    };\n    window.addEventListener(\"click\", windowsClickEvent);\n\n    return () => {\n      window.removeEventListener(\"click\", windowsClickEvent);\n    };\n  }, [popoverRef.current, elementRef.current, popoverPosition]);\n\n  useEffect(() => {\n    const scrollWindow = () => {\n      if (popoverPosition.show) {\n        setPopoverPosition((pre) => ({\n          ...pre,\n          show: false,\n          left: 0,\n          top: 0,\n        }));\n      }\n    };\n\n    window.addEventListener(\"scroll\", scrollWindow);\n    return () => {\n      window.removeEventListener(\"scroll\", scrollWindow);\n    };\n  }, [popoverPosition]);\n  return (\n    <div\n      ref={elementRef}\n      style={{\n        display: \"inline-block\",\n        position: \"relative\",\n      }}>\n      {children}\n\n      <div\n        ref={popoverRef}\n        style={{\n          padding: \"5px\",\n          position: \"absolute\",\n          left: popoverPosition.left,\n          top: popoverPosition.top,\n          right: popoverPosition.right,\n          bottom: popoverPosition.bottom,\n          width: `${popoverPosition.width}px`,\n          visibility: popoverPosition.show ? \"visible\" : \"hidden\",\n          zIndex: popoverPosition.show ? \"1\" : \"-9999999\",\n        }}>\n        <div\n          style={{\n            marginTop: \"5px\",\n            padding: \"5px\",\n            backgroundColor: \"#ffffff\",\n            borderRadius: \"2px\",\n            boxShadow: \"0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)\",\n          }}>\n          {content}\n        </div>\n      </div>\n      <div\n        ref={arrowRef}\n        style={{\n          visibility: popoverPosition.show ? \"visible\" : \"hidden\",\n          zIndex: popoverPosition.show ? \"1\" : \"-9999999\",\n          position: \"absolute\",\n          left: arrowPosition.left,\n          right: arrowPosition.right,\n          top: arrowPosition.top,\n          bottom: arrowPosition.bottom,\n          width: 15,\n          height: 15,\n          clipPath: arrowPosition.clipPath,\n          backgroundColor: \"#ffffff\",\n          boxShadow: \"0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)\",\n        }}></div>\n    </div>\n  );\n};\n\nexport default Popover;\n"],"names":["useRef","useState","useEffect","React"],"mappings":"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"}